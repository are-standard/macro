{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://comi.schema/crop.schema.json",
  "title": "Crop",
  "description": "Agricultural crop definition",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[A-Z_]+$",
      "description": "Unique identifier for the crop"
    },
    "name": {
      "type": "string",
      "description": "Common name of the crop"
    },
    "scientific_name": {
      "type": "string",
      "description": "Scientific/botanical name"
    },
    "category": {
      "type": "string",
      "enum": ["cereals", "legumes", "oilseeds", "root_tubers", "vegetables", "fruits", "forages", "fibers", "sugar", "spices", "beverages", "industrial", "cover_crops"]
    },
    "is_perennial": {
      "type": "boolean",
      "description": "True for perennial crops, false for annual"
    },
    "min_row_width": {
      "type": "number",
      "description": "Minimum row spacing in meters"
    },
    "min_access_width": {
      "type": "number",
      "description": "Minimum width for device access in meters"
    },
    "growth_stages": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/growth_stage"
      }
    },
    "version": {
      "type": "string",
      "description": "Schema version"
    }
  },
  "required": ["id", "name", "category", "is_perennial", "min_row_width", "min_access_width", "growth_stages", "version"],
  "definitions": {
    "growth_stage": {
      "type": "object",
      "properties": {
        "stage_id": {
          "type": "string"
        },
        "stage_name": {
          "type": "string"
        },
        "allowed_operations": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Array of operation IDs allowed at this stage"
        },
        "duration_days": {
          "type": "integer",
          "minimum": 0
        },
        "optimal_conditions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/environmental_condition"
          }
        }
      },
      "required": ["stage_id", "stage_name", "allowed_operations", "duration_days"]
    },
    "environmental_condition": {
      "type": "object",
      "properties": {
        "condition_type": {
          "type": "string",
          "enum": ["soil_moisture", "soil_temperature", "air_temperature", "wind_speed", "humidity", "precipitation"]
        },
        "min_value": {
          "type": "number"
        },
        "max_value": {
          "type": "number"
        },
        "unit": {
          "type": "string"
        },
        "critical": {
          "type": "boolean"
        }
      },
      "required": ["condition_type", "min_value", "max_value", "unit", "critical"]
    }
  }
}