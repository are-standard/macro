{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://comi.schema/operation.schema.json",
  "title": "Operation",
  "description": "Agricultural operation definition",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[A-Z_]+$",
      "description": "Unique identifier for the operation"
    },
    "name": {
      "type": "string",
      "description": "Human-readable name of the operation"
    },
    "description": {
      "type": "string",
      "description": "Detailed description of the operation"
    },
    "category": {
      "type": "object",
      "properties": {
        "primary_category": {
          "type": "string",
          "enum": ["tillage", "planting", "protection", "harvest", "cultivation", "irrigation", "maintenance", "fertilization", "post_harvest"]
        },
        "sub_category": {
          "type": "string"
        },
        "operation_family": {
          "type": "string"
        }
      },
      "required": ["primary_category", "sub_category", "operation_family"]
    },
    "requires_precision": {
      "type": "boolean",
      "description": "True if operation requires precise positioning"
    },
    "soil_condition_requirements": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/environmental_condition"
      }
    },
    "weather_constraints": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/environmental_condition"
      }
    },
    "power_requirements": {
      "$ref": "#/definitions/power_requirement"
    },
    "timing_constraints": {
      "$ref": "#/definitions/timing_constraint"
    },
    "version": {
      "type": "string",
      "description": "Schema version"
    }
  },
  "required": ["id", "name", "category", "requires_precision", "version"],
  "definitions": {
    "environmental_condition": {
      "type": "object",
      "properties": {
        "condition_type": {
          "type": "string",
          "enum": ["soil_moisture", "soil_temperature", "air_temperature", "wind_speed", "humidity", "precipitation"]
        },
        "min_value": {
          "type": "number"
        },
        "max_value": {
          "type": "number"
        },
        "unit": {
          "type": "string"
        },
        "critical": {
          "type": "boolean"
        }
      },
      "required": ["condition_type", "min_value", "max_value", "unit", "critical"]
    },
    "power_requirement": {
      "type": "object",
      "properties": {
        "min_power_hp": {
          "type": "number"
        },
        "max_power_hp": {
          "type": "number"
        },
        "power_type": {
          "type": "string",
          "enum": ["PTO", "hydraulic", "electric", "manual"]
        }
      },
      "required": ["min_power_hp", "max_power_hp", "power_type"]
    },
    "timing_constraint": {
      "type": "object",
      "properties": {
        "season_restrictions": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["spring", "summer", "fall", "winter"]
          }
        },
        "temperature_range": {
          "$ref": "#/definitions/environmental_condition"
        },
        "daylight_required": {
          "type": "boolean"
        },
        "max_wind_speed": {
          "type": "number"
        }
      }
    }
  }
}